{% extends 'baseIn.html.twig' %}
{% block javascripts %}
    <script>
        {% for key, user in fileUser %}
        $(document).ready(queuingUser('{{ user.nom }}', '{{ user.prenom }}', '{{ user.email }}', {{ key }}, '{{ company.id }}'));
        {% endfor %}
        function queuingUser(nom, prenom, email, key, idComp) {
            $.ajax({
                type: "POST",
                url: "/ajax/queuingUser/",
                data : {'nom' : nom, 'prenom' : prenom, 'email' : email, 'key' : key, 'idComp' : idComp},
                success: function (response) {
                    let user = JSON.parse(response.data);
                    if (response.hasOwnProperty('errors') === false) {
                        html = '<li class="collection-item avatar">' +
                            '<img src="/assets/images/placeholder.png" alt="" class="circle">' +
                            '<span class="title">' + user.nom + user.prenom + '</span>' +
                            '<p>' + user.email + '</p>' +
                            '<p class="secondary-content black-text"><i class="material-icons orange-text">update</i>En attente</p>' +
                            '</li>';
                        counter = user.key;
                    } else {
                        console.log(response.errors + response.data);
                        html = '<li class="collection-item avatar">' +
                            '<img src="/assets/images/placeholder.png" alt="" class="circle">' +
                            '<span class="title">' + user.nom + user.prenom + '</span>' +
                            '<p>' + user.email + '</p>' +
                            '<p class="secondary-content black-text"><i class="material-icons red-text">close</i></p>' +
                            '<p class="red-text"><b>' + response.errors + '</b></p>' +
                            '</li>';
                    }
                    $('#listCreatedUser').append(html);
                    $('#counter').html(counter);
                },
                error: function (response) {
                    console.log(response);
                    html = '<li class="collection-item error">' + response.responseStatus + '</li>'
                }
            })
        }
    </script>
{% endblock %}
{% block content %}
    <div class="container">
        <h2>Récapitulatif de la création de {{ company.name }}</h2>
        <div class="row">
            <div class="col s12">
                <h4>L'entreprise</h4>
                <section class="card sticky-action col s12">
                    <div class="logoCompany waves-effect waves-block waves-light center">
                        {% if company.logo is null %}
                            <img src="{{ asset('assets/images/placeholder.png') }}" alt="profile image" class="activator circle responsive-img">
                        {% else %}
                            <img class="activator circle responsive-img" src="{{ asset('uploads/photoCompany/' ~ company.logo) }}" width="80px">
                        {% endif %}
                    </div>
                    <div class="card-content">
                    <span class="card-title activator grey-text text-darken-4">
                        <a href="{{ path('CompanyProfil', { 'slug': company.slug }) }}" class="black-text">
                            <i class="material-icons right">more_vert</i>
                            <span class="truncate">{{ company.nbSalary }} | {{ company.activity }}
                            </span>
                        </a>
                    </span>
                        <div class="row">
                            <p class="left"><a href="{{ path('CompanyProfil', { 'slug': company.slug }) }}">Profil</a></p>
                            <p class="right"><a href="{{ path('Company_edit', { 'slug': company.slug }) }}">Modifier</a></p>
                        </div>
                    </div>
                </section>
            </div>
            <div class="col s12">
            <h4>En attente de création <span id="counter"></span> / {{ fileUser|length }} :</h4>
                <ul class="collection col s12 m6" id="listCreatedUser"></ul>
            </div>
        </div>
    </div>

{% endblock %}

