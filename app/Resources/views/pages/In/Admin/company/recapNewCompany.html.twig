{% extends 'baseIn.html.twig' %}
{% block javascripts %}
    <script>
        //IF newCompany = true
        $(document).ready(
            getUsers('{{ company.id }}')
        );
        function getUsers(idComp) {
            $.ajax({
                type: "POST",
                url: "/ajax/getUserCreated/",
                data : {'idComp' : idComp},
                success: function (response) {
                    let user = JSON.parse(response.data)
                    for(let i = 0; i < user.length; i++) {
                        console.log(user[i]);
                        if (user[i].isTrait === false) {
                            iconStatus = '<p class="secondary-content black-text"><i class="material-icons orange-text">update</i></p>';
                        } else {
                            iconStatus = '<p class="secondary-content black-text"><i class="material-icons green-text">check_circle</i></p>';
                        }
                        html = '<li class="collection-item avatar">' +
                            '<img src="/assets/images/placeholder.png" alt="" class="circle">' +
                            '<span class="title">' + user[i].nom + user[i].prenom + '</span>' +
                            '<p>' + user[i].email + '</p>' +
                            iconStatus +
                            '</li>';
                        if (user[i].isTrait === false) {
                            $('#listWaitUser').append(html);
                            delete html;
                        } else {
                            $('#listCreatedUser').append(html);
                            delete html;
                        }
                    }
                },
                error: function () {
                    console.log('erreurs');
                }
            })
        }
    </script>
{% endblock %}
{% block content %}
    <div class="container">
        <h2>Récapitulatif de la création de {{ company.name }}</h2>
        <div class="row">
            <div class="col s12">
                <h4>L'entreprise</h4>
                <section class="card sticky-action col s12">
                    <div class="logoCompany waves-effect waves-block waves-light center">
                        {% if company.logo is null %}
                            <img src="{{ asset('assets/images/placeholder.png') }}" alt="profile image" class="activator circle responsive-img">
                        {% else %}
                            <img class="activator circle responsive-img" src="{{ asset('uploads/photoCompany/' ~ company.logo) }}" width="80px">
                        {% endif %}
                    </div>
                    <div class="card-content">
                    <span class="card-title activator grey-text text-darken-4">
                        <a href="{{ path('CompanyProfil', { 'slug': company.slug }) }}" class="black-text">
                            <i class="material-icons right">more_vert</i>
                            <span class="truncate">{{ company.nbSalary }} | {{ company.activity }}
                            </span>
                        </a>
                    </span>
                        <div class="row">
                            <p class="left"><a href="{{ path('CompanyProfil', { 'slug': company.slug }) }}">Profil</a></p>
                            <p class="right"><a href="{{ path('Company_edit', { 'slug': company.slug }) }}">Modifier</a></p>
                        </div>
                    </div>
                </section>
            </div>
            <div class="row">
                <div class="col s12 m6">
                    <h4>En attente de création des users</h4>
                    <ul class="collection col s12" id="listWaitUser"></ul>
                </div>
                <div class="col s12 m6">
                    <h4>Utilisateurs créer : <button onclick="getUsers('{{ company.id }}')" class="btn"><i class="material-icons">autorenew</i></button></h4>
                    <ul class="collection col s12" id="listCreatedUser"></ul>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

